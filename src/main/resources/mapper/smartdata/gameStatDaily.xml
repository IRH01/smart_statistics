<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="gameStatDaily">
	<resultMap type="GameStatDaily" id="GameStatDailyMap"  extends="gameSummaryDaily.GameSummaryDailyMap">
		<result property="regAndLoginCount" column="reg_and_login_count"/>
		<result property="regAndRechargeCount" column="reg_and_recharge_count"/>
		<result property="deviceName" column="device_name"/>
	</resultMap>
	
	<select id="statistics" resultMap="GameStatDailyMap" parameterType="map">
		select 
			s.stat_date,
			sum(s.register_count) register_count,
			sum(s.active_count) active_count,
			sum(s.pay_times) pay_times,
			sum(s.pay_count) pay_count,
			sum(s.pay_amount) pay_amount,
			sum(t.reg_and_login_count) reg_and_login_count,
			sum(t.reg_and_recharge_count) reg_and_recharge_count
		from gp_tbl_game_summary_daily s
		left join gp_tbl_game_trans_daily t
			on s.stat_date = t.stat_date
			and s.platform_id = t.platform_id
			and s.device_type = t.device_type
		where 1=1
			<if test="platformId != null">and s.platform_id = #{platformId}</if>
			<if test="startDate != null and endDate != null">and date_format(s.stat_date,'%Y-%m-%d') between #{startDate} and #{endDate}</if>		
         group by s.stat_date
         order by s.stat_date
	</select>
	
	<select id="find" resultMap="GameStatDailyMap" parameterType="map">
		select 
			s.stat_date,
			s.register_count,
			s.active_count,
			s.pay_times,
			s.pay_count,
			s.pay_amount,
			t.reg_and_login_count,
			t.reg_and_recharge_count,
			d.name device_name
		from gp_tbl_game_summary_daily s
		left join gp_tbl_game_trans_daily t
			on s.stat_date = t.stat_date
			and s.platform_id = t.platform_id
			and s.device_type = t.device_type
		left join gp_tbl_terminal_type_d d
			on s.device_type = d.type
		where 1=1
			<if test="platformId != null">and s.platform_id = #{platformId}</if>
			<if test="date != null">and date_format(s.stat_date,'%Y-%m-%d') = #{date}</if>
		order by s.stat_date,d.order_no		
	</select>
</mapper>