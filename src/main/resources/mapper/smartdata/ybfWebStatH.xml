<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ybfWebStatH">

	<resultMap type="com.hhly.smartdata.dto.YbfWebStatH" id="ybfWebStatHMapper">
		<result column="etl_date" property="etlDate" />
		<result column="url_id" property="urlId" />
		<result column="click_cnt" property="clickCnt" />
		<result column="user_cnt" property="userCnt" />
		<result column="ip_cnt" property="ipCnt" />
		<result column="stay_cnt" property="stayCnt" />
		<result column="total_user_cnt" property="totalUserCnt" />
		<result column="day_total_user_cnt" property="dayTotalUserCnt" />
		<result column="url_name" property="urlName" />
		<result column="view_cnt" property="viewCnt" />
	</resultMap>


	<select id="find" resultMap="ybfWebStatHMapper" parameterType="map">
		select
			h.etl_date,
			h.url_id,
			h.click_cnt,
			h.ip_cnt,
			h.stay_cnt,
			h.user_cnt,
			h.total_user_cnt,
			h.day_total_user_cnt,
			h.view_cnt,
			c.url_name
		from tbl_dm_ybf_page_url_stat_h h
		join tbl_dm_dim_ybf_url_stat_cfg c on (c.url_id=h.url_id)
		where 1 = 1
		<if test="date != null">
		    and date_format(h.etl_date,'%Y-%m-%d') = #{date}
		</if>
		<if test="domain != null">
			and c.domain_name = #{domain}
		</if>
		<if test="urlId != null">
			and c.url_id = #{urlId}
		</if>
		order by h.click_cnt desc
	</select>

</mapper>