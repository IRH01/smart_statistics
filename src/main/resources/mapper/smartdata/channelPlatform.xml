<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="channelPlatform">
	<resultMap type="ChannelPlatform" id="ChannelPlatformMap">
		<result property="channelId" column="channel_id"/>
		<result property="channelName" column="channel_name"/>
		<result property="platformId" column="platform_id"/>
		<result property="platformName" column="platform_name"/>
	</resultMap>
	
	<select id="find" resultMap="ChannelPlatformMap" parameterType="ChannelPlatform">
		select 
			cp.channel_id,
			cp.platform_id,
			c.chname as channel_name,
			p.name as platform_name
		from tbl_channel_platform cp
		left join channel c
			on c.chid = cp.channel_id
		left join gp_tbl_platform_info p 
			on p.id = cp.platform_id
		where 1=1
			<if test="channelId != null and channelId != ''">and cp.channel_id like CONCAT(CONCAT('%',#{channelId}),'%')</if>
			<if test="channelName != null and channelName != ''">and c.chname like CONCAT(CONCAT('%',#{channelName}),'%')</if>
			<if test="platformId != null and platformId != ''">and cp.platform_id like CONCAT(CONCAT('%',#{platformId}),'%')</if>
			<if test="platformName != null and platformName != ''">and p.name like CONCAT(CONCAT('%',#{platformName}),'%')</if>
	</select>
	<!-- 精确查找 -->
	<select id="findExactly" resultMap="ChannelPlatformMap" parameterType="ChannelPlatform">
		select 
			cp.channel_id,
			cp.platform_id,
			c.chname as channel_name,
			p.name as platform_name
		from tbl_channel_platform cp
		left join channel c
			on c.chid = cp.channel_id
		left join gp_tbl_platform_info p 
			on p.id = cp.platform_id
		where 1=1
			<if test="channelId != null and channelId != ''">and cp.channel_id = #{channelId}</if>
			<if test="channelName != null and channelName != ''">and c.chname = #{channelName}</if>
			<if test="platformId != null and platformId != ''">and cp.platform_id = #{platformId}</if>
			<if test="platformName != null and platformName != ''">and p.name = #{platformName}</if>
	</select>
	
	<select id="findByChannelId" resultMap="ChannelPlatformMap" parameterType="String">
		select * from tbl_channel_platform where channel_id = #{channelId}
	</select>
	
	<insert id="add" parameterType="ChannelPlatform">
		insert into tbl_channel_platform(
			channel_id,
			platform_id,
			create_time
		)
		values(
			#{channelId},
			#{platformId},
			sysdate
		)
	</insert>
	<delete id="deleteById" parameterType="string">
		delete from tbl_channel_platform where channel_id = #{channelId}
	</delete>
	
	
	
	<select id="findChannel" parameterType="string" resultType="string">
		select chname from channel where chid = #{channelId}
	</select>
	
</mapper>