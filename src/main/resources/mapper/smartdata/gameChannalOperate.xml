<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="gameChannalOperate">
    <resultMap type="GameChannalOperate" id="GameChannalOperateMap" extends="lossDaily.LossDailyMap">
        <result property="statDate" column="stat_date"/>
        <result property="channelId" column="channel_id"/>
        <result property="platformId" column="platform_id"/>
        <result property="product" column="product"/>
        <result property="newVister" column="new_vister"/>
        <result property="registUser" column="regist_user"/>
        <result property="activeUser" column="active_user"/>
        <result property="rechargeUser" column="recharge_user"/>
        <result property="rechargeAmount" column="recharge_amount"/>
        <result property="xhAmount" column="xh_amount"/>
        <result property="fcRate" column="fc_rate"/>
        <result property="platformIncome" column="platform_income"/>
        <result property="fcIncome" column="fc_income"/>
        <result property="platformTerminal" column="platform_terminal"/>
        <result property="produceId" column="produce_id"/>
        <result property="produceName" column="produce_name"/>
    </resultMap>

    <select id="find" resultMap="GameChannalOperateMap" parameterType="map">
        select channel_id, product, sum(new_vister) as new_vister, sum(regist_user) as regist_user,
        sum(active_user) as active_user, sum(recharge_user) as recharge_user,
        FORMAT(sum(recharge_amount),2) as recharge_amount,
        FORMAT(sum(xh_amount),2) as xh_amount,
        FORMAT(fc_rate,2) as fc_rate ,
        FORMAT(sum(platform_income),2) as platform_income,
        FORMAT(sum(fc_income),2) as fc_income,
        platform_terminal from
        view_gp_channel_operation_day
        where 1 = 1
        <if test="channelId != null and channelId != ''">and channel_id like CONCAT(CONCAT('%',#{channelId}),'%')</if>
        <if test="platformId != null and platformId != ''">and product = #{platformId}</if>
        <if test="os != null and os != ''">and platform_terminal = #{os}</if>
        <if test="dateStart != null and dateStart != ''">and date_format(stat_date,'%Y-%m-%d') &gt;= #{dateStart}</if>
        <if test="dateEnd != null and dateEnd != ''">and date_format(stat_date,'%Y-%m-%d') &lt;= #{dateEnd}</if>
        group by channel_id, product, platform_terminal, fc_rate
    </select>


    <select id="count" resultType="int" parameterType="map">
        select count(1) from
        view_gp_channel_operation_day
        where 1 = 1
        <if test="channelId != null and channelId != ''">and channel_id like CONCAT(CONCAT('%',#{channelId}),'%')</if>
        <if test="platformId != null and platformId != ''">and product = #{platformId}</if>
        <if test="os != null and os != ''">and platform_terminal = #{os}</if>
        <if test="dateStart != null and dateStart != ''">and date_format(stat_date,'%Y-%m-%d') &gt;= #{dateStart}</if>
        <if test="dateEnd != null and dateEnd != ''">and date_format(stat_date,'%Y-%m-%d') &lt;= #{dateEnd}</if>
        order by stat_date desc
    </select>

    <select id="getProduces" resultMap="GameChannalOperateMap" parameterType="map">
        select id as produce_id , name as produce_name from view_gp_dim_product_market
    </select>
</mapper>