<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="lmdzChannelDaily">
	<resultMap type="LmdzChannelDaily" id="LmdzChannelDailyMap">
		<result property="channelId" column="channel_id"/>
		<result property="userId" column="user_id"/>
		<result property="regDate" column="reg_date"/>
		<result property="grade" column="grade"/>
		<result property="rechargeAmount" column="recharge_amount"/>
		<result property="inning" column="inning"/>
		
		<result property="osid" column="id"/>
		<result property="osname" column="os_name"/>
	</resultMap>
	
	<resultMap type="LmdzChannelDailySum" id="LmdzChannelDailySumMap">
		<result property="userCount" column="user_count"/>
		<result property="rechargeAmountSum" column="recharge_amount_sum"/>
		<result property="inningSum" column="inning_sum"/>
	</resultMap>
	
	<select id="find" resultMap="LmdzChannelDailyMap" parameterType="map">
		select 
			cd.channel_id,
			cd.os_name,
			cd.user_id,
			cd.reg_date,
			cd.grade,
			cd.recharge_amount,
			cd.inning
		from view_lmdz_channel_daily cd
		join tbl_user_channel uc
			on uc.channel_id = cd.channel_id
		where 1=1
			<if test="dateStart != null and dateStart != ''">and date_format(cd.reg_date,'%Y-%m-%d') &gt;= #{dateStart}</if>
			<if test="dateEnd != null and dateEnd != ''">and date_format(cd.reg_date,'%Y-%m-%d') &lt;= #{dateEnd}</if>
			<if test="grade != null and grade != ''">and cd.grade = #{grade}</if>
			<if test="userId != null and userId != ''">and uc.user_id = #{userId}</if>
			<if test="os != null and os != ''">and cd.os_type = #{os}</if>
			<if test="channelId != null and channelId != ''">and cd.channel_Id like CONCAT(CONCAT('%',#{channelId}),'%')</if>	    
        order by cd.reg_date desc
	</select>
	
	<select id="count" resultType="int" parameterType="map">
		select 
			count(*) count
		from view_lmdz_channel_daily cd
		join tbl_user_channel uc
			on uc.channel_id = cd.channel_id
		where 1=1
			<if test="dateStart != null and dateStart != ''">and date_format(cd.reg_date,'%Y-%m-%d') &gt;= #{dateStart}</if>
			<if test="dateEnd != null and dateEnd != ''">and date_format(cd.reg_date,'%Y-%m-%d') &lt;= #{dateEnd}</if>
			<if test="grade != null and grade != ''">and cd.grade = #{grade}</if>
			<if test="userId != null and userId != ''">and uc.user_id = #{userId}</if>
			<if test="os != null and os != ''">and cd.os_type = #{os}</if>
			<if test="channelId != null and channelId != ''">and cd.channel_Id like CONCAT(CONCAT('%',#{channelId}),'%')</if>	 	
	</select>
	
	<select id="sum" resultMap="LmdzChannelDailySumMap" parameterType="map">
		select 
			count(cd.user_id) user_count,
			sum(cd.recharge_amount) recharge_amount_sum,
			sum(cd.inning) inning_sum
		from view_lmdz_channel_daily cd
		join tbl_user_channel uc
			on uc.channel_id = cd.channel_id
		where 1=1
			<if test="dateStart != null and dateStart != ''">and date_format(cd.reg_date,'%Y-%m-%d') &gt;= #{dateStart}</if>
			<if test="dateEnd != null and dateEnd != ''">and date_format(cd.reg_date,'%Y-%m-%d') &lt;= #{dateEnd}</if>
			<if test="grade != null and grade != ''">and cd.grade = #{grade}</if>
			<if test="userId != null and userId != ''">and uc.user_id = #{userId}</if>
			<if test="os != null and os != ''">and cd.os_type = #{os}</if>
			<if test="channelId != null and channelId != ''">and cd.channel_Id like CONCAT(CONCAT('%',#{channelId}),'%')</if>	 
	</select>
	
	<select id="getGrades" resultType="String" parameterType="map">
		select 
			cd.grade
		from view_lmdz_channel_daily cd
		join tbl_user_channel uc
			on uc.channel_id = cd.channel_id
		where 1=1
			<if test="userId != null and userId != ''">and uc.user_id = #{userId}</if>
		group by cd.grade
		order by CONVERT(cd.grade,SIGNED) asc
	</select>
	
	<select id="getOss" resultMap="LmdzChannelDailyMap" parameterType="map">
		select id , name as os_name from tbl_gp_plat_terminal_info
	</select>
</mapper>